webpackJsonp([8],{"+L4n":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("Gu7T"),a=s.n(r),l=(s("NYxO"),{components:{"el-select-tree":s("2Yd0").a},data:function(){return{totalCount:0,list:[],listLoading:!1,listQuery:{pageNum:1,pageRow:10},orgTree:[],orgPk:[],defaultProps:{children:"children",label:"name",id:"id"},roles:[],dialogStatus:"create",dialogFormVisible:!1,textMap:{update:"编辑",create:"新建用户"},tempUser:{username:"",password:"",nickname:"",roleId:"",userId:"",phone:"",orgId:"",webUsername:"",icNumber:"",orgPk:""}}},created:function(){this.getList(),(this.hasPerm("user:add")||this.hasPerm("user:update"))&&this.getAllRoles(),this.initOrg(),this.initOrgPk()},methods:{getAllRoles:function(){var e=this;this.api({url:"/user/getAllRoles",method:"get"}).then(function(t){e.roles=t.list})},initOrg:function(){var e=this;this.api({url:"/org/listOrg",method:"get"}).then(function(t){var s;e.orgTree=[],(s=e.orgTree).push.apply(s,a()(t))})},initOrgPk:function(){var e=this;this.api({url:"/webchatConfig/listAll",method:"get"}).then(function(t){e.orgPk=t.list})},getList:function(){var e=this;this.listLoading=!0,this.api({url:"/user/list",method:"get",params:this.listQuery}).then(function(t){e.listLoading=!1,e.list=t.list,e.totalCount=t.totalCount})},handleSizeChange:function(e){this.listQuery.pageRow=e,this.handleFilter()},handleCurrentChange:function(e){this.listQuery.pageNum=e,this.getList()},handleFilter:function(){this.listQuery.pageNum=1,this.getList()},getIndex:function(e){return(this.listQuery.pageNum-1)*this.listQuery.pageRow+e+1},showCreate:function(){this.tempUser.username="",this.tempUser.password="",this.tempUser.nickname="",this.tempUser.roleId="",this.tempUser.userId="",this.tempUser.phone="",this.tempUser.orgId="",this.tempUser.orgPk="",this.dialogStatus="create",this.dialogFormVisible=!0},showUpdate:function(e){var t=this.list[e];this.tempUser.username=t.username,this.tempUser.nickname=t.nickname,this.tempUser.roleId=t.roleId,this.tempUser.userId=t.userId,this.tempUser.deleteStatus="1",this.tempUser.phone=t.phone,this.tempUser.orgId=t.orgId,this.tempUser.password="",this.tempUser.orgPk=t.pkOrg,this.dialogStatus="update",this.dialogFormVisible=!0},createUser:function(){var e=this;this.api({url:"/user/addUser",method:"post",data:this.tempUser}).then(function(){e.getList(),e.dialogFormVisible=!1})},updateUser:function(){var e=this,t=this;this.api({url:"/user/updateUser",method:"post",data:this.tempUser}).then(function(){e.dialogFormVisible=!1,e.$message({message:"修改成功",type:"success",duration:1e3,onClose:function(){t.getList()}})})},removeUser:function(e){var t=this;this.$confirm("确定删除此用户?","提示",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){var s=t.list[e];s.deleteStatus="2",t.api({url:"/user/updateUser",method:"post",data:s}).then(function(){t.getList()}).catch(function(){t.$message.error("删除失败")})})}}}),i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("el-form",[s("el-form-item",[e.hasPerm("user:add")?s("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.showCreate}},[e._v("添加\n        ")]):e._e()],1)],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.list,"element-loading-text":"拼命加载中",border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{align:"center",label:"序号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(e.getIndex(t.$index))}})]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"姓名",prop:"nickname",width:"100px;"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"用户名",prop:"username",width:"100px;"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"角色",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.roleId?s("el-tag",{attrs:{type:"success"},domProps:{textContent:e._s(t.row.roleName)}}):s("el-tag",{attrs:{type:"primary"},domProps:{textContent:e._s(t.row.roleName)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"手机号",prop:"phone",width:"150"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"分公司",prop:"pkName",width:"150"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"组织",prop:"orgName",width:"200"}}),e._v(" "),e.hasPerm("user:delete")||e.hasPerm("user:update")?s("el-table-column",{attrs:{align:"center",label:"管理",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPerm("user:update")?s("el-button",{attrs:{type:"primary",icon:"edit"},on:{click:function(s){e.showUpdate(t.$index)}}},[e._v("修改")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"danger",icon:"delete"},on:{click:function(s){e.removeUser(t.$index)}}},[e._v("删除\n        ")])]}}])}):e._e()],1),e._v(" "),s("el-pagination",{attrs:{"current-page":e.listQuery.pageNum,"page-size":e.listQuery.pageRow,total:e.totalCount,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{staticClass:"small-space",staticStyle:{width:"600px","margin-left":"50px"},attrs:{inline:!0,model:e.tempUser,"label-position":"left","label-width":"80px"}},["create"==e.dialogStatus?s("el-form-item",{attrs:{label:"用户名",required:""}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.username,callback:function(t){e.$set(e.tempUser,"username",t)},expression:"tempUser.username"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"手机号"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.phone,callback:function(t){e.$set(e.tempUser,"phone",t)},expression:"tempUser.phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"IC卡号"}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.icNumber,callback:function(t){e.$set(e.tempUser,"icNumber",t)},expression:"tempUser.icNumber"}})],1),e._v(" "),"create"==e.dialogStatus?s("el-form-item",{attrs:{label:"密码",required:""}},[s("el-input",{attrs:{type:"password"},model:{value:e.tempUser.password,callback:function(t){e.$set(e.tempUser,"password",t)},expression:"tempUser.password"}})],1):s("el-form-item",{attrs:{label:"新密码"}},[s("el-input",{attrs:{type:"password",placeholder:"不填则表示不修改"},model:{value:e.tempUser.password,callback:function(t){e.$set(e.tempUser,"password",t)},expression:"tempUser.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"角色",required:""}},[s("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:e.tempUser.roleId,callback:function(t){e.$set(e.tempUser,"roleId",t)},expression:"tempUser.roleId"}},e._l(e.roles,function(e){return s("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"昵称",required:""}},[s("el-input",{attrs:{type:"text"},model:{value:e.tempUser.nickname,callback:function(t){e.$set(e.tempUser,"nickname",t)},expression:"tempUser.nickname"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"分公司",required:""}},[s("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:e.tempUser.orgPk,callback:function(t){e.$set(e.tempUser,"orgPk",t)},expression:"tempUser.orgPk"}},e._l(e.orgPk,function(e){return s("el-option",{key:e.pkOrg,attrs:{label:e.name,value:e.pkOrg}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"所属机构"}},[s("el-select-tree",{staticStyle:{width:"310px"},attrs:{treeData:e.orgTree,propNames:e.defaultProps,clearable:"",placeholder:"请选择机构"},model:{value:e.tempUser.orgId,callback:function(t){e.$set(e.tempUser,"orgId",t)},expression:"tempUser.orgId"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),"create"==e.dialogStatus?s("el-button",{attrs:{type:"success"},on:{click:e.createUser}},[e._v("创 建")]):s("el-button",{attrs:{type:"primary"},on:{click:e.updateUser}},[e._v("修 改")])],1)],1)],1)},staticRenderFns:[]},o=s("VU/8")(l,i,!1,null,null,null);t.default=o.exports}});